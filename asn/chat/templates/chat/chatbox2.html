{% load staticfiles %}

<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>Chatbox</title>
{#   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">#}
   <link rel="stylesheet" href="{% static 'css/chatbox/chatbox.css' %}">
</head>
<body>
<!-- partial:index.partial.html -->
<div class="wrap">
	<div class="head">
		
		<div class="center">
			<div class="head_left">
				<h5>Alexandr Volodin</h5>
				<div class="head_left_img"></div>
			</div>
			<div class="head_right">
				<div class="head_right_img"></div>
				<h5>Me</h5>
			</div>
		</div>
		
	</div>
	<div class="body" style="border-bottom: darkslategrey solid 1px; overflow-y: scroll;">
		<div class="left">
			<figure class="s-message">
				<figcaption><span>Alexandr</span>12:35
					<div class="dot"></div>
				</figcaption>
				<p>Hi, dude! How are you?)</p>
			</figure>
			<figure class="left-message">
				<figcaption><span>Alexandr</span>12:38
					<div class="dot"></div>
				</figcaption>
				<p>Alexandr left conversation</p>
			</figure>
		</div>

		<div class="right" id="rg_chat">
			<figure class="u-message">
				<figcaption>
					<div class="dot_green"></div><span>Me</span>12:36</figcaption>
				<p>Where's my money?</p>
			</figure>
		</div>
	</div>
	<div class="footer">
			<div class="sending-message">
				<button class="send" id="send-message">SEND<svg id="send-ico" viewBox="0 0 26.5 22.9" >
                <polygon points="5.8,0 26.5,12.4 5.3,22.9 6.6,14.8 0,10.4 11.3,10.4 6.4,7.7 "/>
                </svg>
                </button>
				<textarea type="text" class="message-input" placeholder="Type message..." id="chat-message-input"></textarea>
			</div>
	</div>
	<div class="line"></div>
</div>
<!-- partial -->
<script>
    var roomName = {{ room_name_json }};

    var chatSocket = new WebSocket(
        'ws://' + window.location.host +
        '/ws/chat/' + roomName + '/');

    chatSocket.onmessage = function(e) {
        var data = JSON.parse(e.data);
        var message = data['message'];
        {#console.log(message);#}
        /* Chat text area */
        {#sendMess(message);#}

        sendMess(message)
        {#document.querySelector('#chat-log').value += (message + '\n');#}
    };

    chatSocket.onclose = function(e) {
        console.error('Chat socket closed unexpectedly');
    };

    document.querySelector('#chat-message-input').focus();
    document.querySelector('#chat-message-input').onkeyup = function(e) {
        if (e.keyCode === 13) {  // enter, return
            document.querySelector('#send-message').click();
        }
    };

    document.querySelector('#send-message').onclick = function(e) {
        var messageInputDom = document.querySelector('#chat-message-input');
        var message = messageInputDom.value;
        {#console.log(message);#}
        chatSocket.send(JSON.stringify({
            'message': message
        }));

        messageInputDom.value = '';
    };
</script>
 <script src="{{ jQuery }}"></script>
<script src='{{ jQueryNiceRoll }}'></script>
<script  src="{% static 'js/chatbox/chatbox.js' %}"></script>

</body>
</html>
